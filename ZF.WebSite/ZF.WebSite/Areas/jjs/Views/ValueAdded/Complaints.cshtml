@{
    Layout = "~/Areas/jjs/Views/Shared/_Layout.cshtml";
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta content="email=no" name="format-detection">
    <meta http-equiv="Cache-Control" CONTENT="no-cache">
    <meta http-equiv="pragram" content="no-cache">
    <link href="@HttpContext.Current.Application["DefuleDomain"]/Areas/jjs/resources/style/user.css" rel="stylesheet" type="text/css">
    <link href="@HttpContext.Current.Application["DefuleDomain"]/Areas/jjs/resources/style/zengzhi.css" rel="stylesheet" />
    <title>增值服务</title>
</head>
<body>
    <div class="zengz_box">
        <h2>盗版图书投诉</h2>
        <div class="tousu">
            <div class="zengz_list">
                <h3>网店名称</h3>
                <textarea name="textarea" id="BranchesName" placeholder="若在网店购买输入店铺名称或网址"></textarea>
            </div>

            <div class="zengz_list">
                <h3>实体店地址</h3>
                <textarea name="textarea" id="PhysicalStoreName" placeholder="若在实体店购买输入地址"></textarea>
            </div>
            <div class="zengz_list">
                <h3>书籍封面照片</h3>
                <div class="zengz_fm">
                    <a href="#" class="zp_anniu" onclick="wxSYS()">选择照片</a>
                    <a href="#" class="zhaopian">
                    </a>
                    <div class="clear"></div>
                </div>
            </div>
        </div>
        <dl class="zzqueding">
            <dt><a href="#" onclick="save()">提交</a></dt>
            <dd><a href="#" onclick="cz();">重置</a></dd>
            <div class="clear"></div>
        </dl>
        <p style="line-height: 3em; text-align: center;">感谢您提供的线索和对正版图书的支持</p>
    </div>
</body>
</html>
<script type="text/javascript" src="@HttpContext.Current.Application["DefuleDomain"]/Areas/jjs/resources/js/top/koala.min.1.5.js?v=1.0"></script>
<script src="@HttpContext.Current.Application["DefuleDomain"]/Images/Home/js/ajax.js" type="text/javascript"></script>
<script src="@HttpContext.Current.Application["DefuleDomain"]/Js/jweixin-1.0.0.js?v=1.0"></script>
<script type="text/javascript">
    var Code = decodeURI(topevery.getUrlParam("Code"));
    function wxSYS() {
        topevery.ajaxToThis({
            type: "Post",
            url: "/jjs/PersonalCenter/GetJsapiTicketPublic",
            data: JSON.stringify({ "findUrl": window.location.href }),
            dataType: "html"
        }, function (data) {
            var row = JSON.parse(data);
            wx.config({
                debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                appId: row.appId, // 必填，公众号的唯一标识
                timestamp: parseInt(row.timestamp), // 必填，生成签名的时间戳
                nonceStr: row.nonceStr, // 必填，生成签名的随机串
                signature: row.signature, // 必填，签名，见附录1
                jsApiList: [
        'checkJsApi',
        'onMenuShareTimeline',
        'onMenuShareAppMessage',
        'onMenuShareQQ',
        'onMenuShareWeibo',
        'onMenuShareQZone',
        'hideMenuItems',
        'showMenuItems',
        'hideAllNonBaseMenuItem',
        'showAllNonBaseMenuItem',
        'translateVoice',
        'startRecord',
        'stopRecord',
        'onVoiceRecordEnd',
        'playVoice',
        'onVoicePlayEnd',
        'pauseVoice',
        'stopVoice',
        'uploadVoice',
        'downloadVoice',
        'chooseImage',
        'previewImage',
        'uploadImage',
        'downloadImage',
        'getNetworkType',
        'openLocation',
        'getLocation',
        'hideOptionMenu',
        'showOptionMenu',
        'closeWindow',
        'scanQRCode',
        'chooseWXPay',
        'openProductSpecificView',
        'addCard',
        'chooseCard',
        'openCard'
                ] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
            });
            wx.chooseImage({
                count: 1,
                success: function (res) {//上传图片到微信成功的回调函数   会返回一个媒体对象  存储了图片在微信的id
                    uploadToWeixinServer(res.localIds[0], 'car');
                },
                fail: function (res) {
                }
            });
        });
    }
    function uploadToWeixinServer(localId, type) {
        wx.uploadImage({
            localId: localId,
            isShowProgressTips: 1, // 默认为1，显示进度提示
            success: function (res) {
                uploadToOwnerServer(res.serverId, type);//异步上传到我们自己的服务器
            }
        });
    }
    function uploadToOwnerServer(serverId, type) {
        topevery.ajaxToThis({
            type: "Post",
            url: "/api/WeiXin11/GetWeiXinMedia?mediaId=" + serverId,
            dataType: "html"
        }, function (json) {
            $('.zhaopian').attr('data', json);
            $('.zhaopian').attr('style', 'background:url(' + json + ') no-repeat;background-size:100%');
        });
    };

    function save() {
        var obj = new Object();
        if ($("#BranchesName").val()) {
            obj.BranchesName = $("#BranchesName").val();
        }
        if ($("#PhysicalStoreName").val()) {
            obj.PhysicalStoreName = $("#PhysicalStoreName").val();
        }
        obj.ImageUrl = $('.zhaopian').attr('data');
        if (obj.BranchesName || obj.PhysicalStoreName) {
            topevery.ajaxwx({
                type: "Post",
                url: "api/CourseAppraise/Complaints",
                data: JSON.stringify(obj)
            }, function (json) {
                if (json.Result) {
                    layer.msg("提交成功!");
                    setTimeout(function () { location.href = "/jjs/HomePage/Index" }, 400);
                }
            });
        } else {
            layer.msg("网店名称,实体店地址必填一项!");
        }
    }
    function cz() {
        location.reload();
    }
</script>